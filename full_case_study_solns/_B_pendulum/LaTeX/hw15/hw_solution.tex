From HW~\ref{ds:pendulum}.\ref{chap:transfer_function_models}, the transfer function for the inner loop of the inverted pendulum is 
\begin{equation}\label{eq:hw_pendulum_bode_in_tf}
%P_{in}(s) = \frac{-2/m_2\ell}{s^2-\frac{2(m_1+m_2)g}{m_2\ell}} = 
%\frac{-4}{s^2 - 49} = \frac{-4}{(s+7)(s-7)}. 
P_{in}(s) = \frac{\frac{-1}{(m_1 \frac{\ell}{6}+ m_2 \frac{2 \ell}{3})}}{s^2-\frac{(m_1+m_2)g}{(m_1 \frac{\ell}{6}+ m_2 \frac{2 \ell}{3})}} = 
\frac{-2.823}{s^2 - 34.58} = \frac{-2.823}{(s+5.881)(s-5.881)}.  % originally the parameters that were choosen made this turn out very nicely in terms of pole position, may want to choose different parameters to get the same effect? ckp 1/16/19
\end{equation}
In Bode canonical form we have
\[
P_{in}(j\omega) = \frac{0.0816}{(1+j\frac{\omega}{5.881})(1-j\frac{\omega}{5.881})}
\]
Therefore
\begin{multline} \label{eq:loop_bode_pendulum_in}
20\log_{10}\abs{P_{in}(j\omega)}=
	20\log_{10} 0.0816 \\
	-20\log_{10}\abs{1+j\frac{\omega}{5.881}}
	-20\log_{10}\abs{1-j\frac{\omega}{5.881}}.
\end{multline}
Therefore, the Bode plot for magnitude will be the graphical addition of a constant gain, a right half plane pole, and a left half plane pole.
Similarly, the phase is given by
\[
\angle P_{in}(j\omega) = 
	\angle 0.0816 
	- \angle (1+j\frac{\omega}{5.881})
	- \angle (1-j\frac{\omega}{5.881}).
\]
The straight-line approximation as well as the Bode plot generated by Matlab are shown in \fref{fig:hw_pendulum_bode_in}.
\controlbookfigurefullpage{0.7}
	{6_design_studies/figures/hw_pendulum_bode_in}
	{Bode plot for the transfer function given in Equation~\eqref{eq:loop_bode_pendulum_in}.}
	{fig:hw_pendulum_bode_in}
%The Python command to generate the Bode plot is
%\begin{lstlisting}
%import pendulumParam as P
%import control as cnt
%import matplotlib.pyplot as plt
%
%# Compute inner and outer open-loop transfer functions
%P_in = cnt.tf([-1/(P.m1*P.ell/6+P.m2*2*P.ell/3)],
%          [1, 0, -(P.m1+P.m2)*P.g/(P.m1*P.ell/6+P.m2*2*P.ell/3)])
%# Plot the closed loop and open loop bode plots for the inner loop
%plt.figure(1), cnt.bode(P_in, dB=True), plt.show()
%\end{lstlisting}

From HW~\ref{ds:pendulum}.\ref{chap:transfer_function_models}, the transfer function for the outer loop of the inverted pendulum is 
\begin{equation}\label{eq:soln_b20out_tf}
P_{out}(s) = \frac{\frac{\ell}{2}s^2-9.8}{s^2} = 
\frac{-0.25s^2+9.8}{s^2} = \frac{-0.25(s-6.26)(s+6.26)}{s^2}. 
\end{equation}
In Bode canonical form we have
\[
P_{out}(j\omega) = \frac{0.034(j\omega/6.26+1)(-j\omega/6.26+1)}{(j\omega)^2}.
\]
Therefore
\begin{multline} \label{eq:loop_bode_pendulum_out}
20\log_{10}\abs{P_{out}(j\omega)}= \\
	20\log_{10} 0.034 + 	20\log_{10}\abs{1+j\frac{\omega}{6.26}} \\
	+ 	20\log_{10}\abs{1+j\frac{\omega}{-6.26}}
	-20\log_{10}\abs{\omega}^2.
\end{multline}
Similarly, the phase is given by
\[
\angle P_{out}(j\omega) = 
	\angle 0.034 
	+ \angle (1+j\frac{\omega}{6.26})
	+ \angle (1-j\frac{\omega}{6.26})
	- \angle (j\omega)
	- \angle (j\omega).
\]
The straight-line approximation as well as the Bode plot generated by Matlab are shown in \fref{fig:hw_pendulum_bode_out}.
\controlbookfigurefullpage{0.7}
	{6_design_studies/figures/hw_pendulum_bode_out}
	{Bode plot for the transfer function given in Equation~\eqref{eq:loop_bode_pendulum_out}.}
	{fig:hw_pendulum_bode_out}
	
Python code to generate similar Bode plots for the previous two figures is as follows:

\lstinputlisting[language=Python, caption=pendulumParamHW15.py]{../control_book_public_solutions/_B_pendulum/python/hw15/pendulumParamHW15.py}
